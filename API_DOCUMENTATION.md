# üöÄ Jack Marvels API Documentation

## üìã Overview

This document provides the core API documentation for the Jack Marvels application backend. The API supports student talent competitions with essential features for authentication, video uploads, and subscription management.

---

## üîß Base Configuration

### Base URL

```
Production: https://api.jackmarvels.com
Staging: https://staging-api.jackmarvels.com
Development: http://localhost:3000
```

### Authentication

All authenticated endpoints require a Bearer token in the Authorization header:

```
Authorization: Bearer <access_token>
```

### Response Format

All API responses follow this standard format:

```json
{
  "success": true,
  "data": {
    /* response data */
  },
  "message": "Success message",
  "statusCode": 200,
  "timestamp": "2024-01-25T10:00:00.000Z"
}
```

### Error Response Format

```json
{
  "success": false,
  "error": "Error message",
  "statusCode": 400,
  "timestamp": "2024-01-25T10:00:00.000Z"
}
```

---

## üîê Core APIs (8 Endpoints) - Mobile App Only

**Note:** This API documentation is specifically for the mobile app, which only supports **Influencers** and **Students**. Super Admins and Admins use a separate web-based admin panel.

### 1. Send OTP

**Endpoint:** `POST /auth/send-otp`

**Request Body:**

```json
{
  "mobile": "9876543210",
  "type": "login"
}
```

**Response:**

```json
{
  "success": true,
  "data": {
    "message": "OTP sent successfully",
    "mobile": "9876543210",
    "expiresIn": 300,
    "otpMessage": "Jack Marvels: Your OTP is 123456. Valid for 3 minutes. Do not share this code with anyone. ABCD1234",
    "smsHash": "ABCD1234"
  },
  "statusCode": 200
}
```

**SMS Message Format for Android Auto-read:**

```
Jack Marvels: Your OTP is XXXXXX. Valid for 3 minutes. Do not share this code with anyone. [SMS_HASH]
```

**Important:** The SMS hash must be included at the end of the SMS message for Android auto-read to work. The hash is generated by the mobile app and provided in the API response.

### 2. Verify OTP

**Endpoint:** `POST /auth/verify-otp`

**Request Body:**

```json
{
  "mobile": "9876543210",
  "otp": "123456"
}
```

**Response:**

```json
{
  "success": true,
  "data": {
    "user": {
      "id": "user_001",
      "firstName": "Rahul",
      "lastName": "Sharma",
      "email": "rahul.sharma@example.com",
      "mobile": "9876543210",
      "state": "Maharashtra",
      "district": "Mumbai",
      "city": "Mumbai",
      "pincode": "400001",
      "profileImage": "https://example.com/avatar.jpg",
      "roleId": 4,
      "role": "student",
      "isVerified": true,
      "createdAt": "2024-01-15T10:00:00Z",
      "updatedAt": "2024-01-15T10:00:00Z"
    },
    "tokens": {
      "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "expiresIn": 3600
    }
  },
  "statusCode": 200
}
```

### 3. Registration

**Endpoint:** `POST /auth/register`

**Note:** Only students can register through the mobile app. Influencers are managed separately through admin panel.

**Request Body:**

```json
{
  "firstName": "Priya",
  "lastName": "Patel",
  "email": "priya.patel@example.com",
  "mobile": "8765432109",
  "state": "Gujarat",
  "district": "Ahmedabad",
  "city": "Ahmedabad",
  "pincode": "380001"
}
```

**Response:**

```json
{
  "success": true,
  "data": {
    "id": "user_002",
    "firstName": "Priya",
    "lastName": "Patel",
    "email": "priya.patel@example.com",
    "mobile": "8765432109",
    "state": "Gujarat",
    "district": "Ahmedabad",
    "city": "Ahmedabad",
    "pincode": "380001",
    "profileImage": null,
    "roleId": 4,
    "role": "student",
    "isVerified": false,
    "createdAt": "2024-01-10T14:30:00Z",
    "updatedAt": "2024-01-10T14:30:00Z"
  },
  "statusCode": 201
}
```

### 4. Dashboard API

**Endpoint:** `GET /dashboard`

**Headers:** `Authorization: Bearer <access_token>`

**Response for Students (roleId: 4):**

```json
{
  "success": true,
  "data": {
    "user": {
      "id": "user_001",
      "firstName": "Rahul",
      "lastName": "Sharma",
      "email": "rahul.sharma@example.com",
      "mobile": "9876543210",
      "profileImage": "https://example.com/avatar.jpg",
      "roleId": 4,
      "role": "student"
    },
    "events": [
      {
        "id": "event_001",
        "title": "National Anthem",
        "description": "Sing the national anthem with pride and patriotism",
        "category": "Singing",
        "isActive": true,
        "startDate": "2024-01-15T00:00:00Z",
        "endDate": "2024-02-15T23:59:59Z",
        "canUpload": true,
        "uploadStartDate": "2024-01-15T00:00:00Z",
        "uploadEndDate": "2024-02-10T23:59:59Z",
        "allowedRoles": [4],
        "createdAt": "2024-01-01T00:00:00Z"
      },
      {
        "id": "event_002",
        "title": "Tongue Twister",
        "description": "Master challenging tongue twisters with speed and clarity",
        "category": "Speaking",
        "isActive": true,
        "startDate": "2024-02-01T00:00:00Z",
        "endDate": "2024-03-01T23:59:59Z",
        "canUpload": false,
        "uploadStartDate": "2024-02-01T00:00:00Z",
        "uploadEndDate": "2024-02-25T23:59:59Z",
        "allowedRoles": [4],
        "createdAt": "2024-01-01T00:00:00Z"
      }
    ],
    "subscription": {
      "id": "sub_001",
      "userId": "user_001",
      "plan": "premium",
      "amount": 100,
      "paymentMethod": "razorpay",
      "status": "active",
      "startDate": "2024-01-01T00:00:00Z",
      "endDate": "2024-12-31T23:59:59Z",
      "transactionId": "txn_123456789",
      "canUploadVideos": true,
      "maxVideosPerMonth": 10,
      "videosUploadedThisMonth": 3
    },
    "stats": {
      "totalVideos": 5,
      "totalEvents": 15,
      "unreadNotifications": 3,
      "activeEvents": 8,
      "eventsWithOpenUploads": 3
    }
  },
  "statusCode": 200
}
```

**Response for Influencers (roleId: 3):**

```json
{
  "success": true,
  "data": {
    "user": {
      "id": "user_002",
      "firstName": "Priya",
      "lastName": "Patel",
      "email": "priya.patel@example.com",
      "mobile": "8765432109",
      "profileImage": "https://example.com/avatar.jpg",
      "roleId": 3,
      "role": "influencer"
    },
    "events": [
      {
        "id": "inf_event_001",
        "title": "Register School",
        "description": "Register your school to participate in Jack Marvels competitions",
        "type": "school_registration",
        "isActive": true,
        "createdAt": "2024-01-01T00:00:00Z"
      },
      {
        "id": "inf_event_002",
        "title": "View History",
        "description": "View your school's participation history and achievements",
        "type": "history",
        "isActive": true,
        "createdAt": "2024-01-01T00:00:00Z"
      }
    ],
    "stats": {
      "totalSchools": 5,
      "totalEvents": 2,
      "unreadNotifications": 1,
      "activeEvents": 2,
      "eventsWithOpenUploads": 0
    }
  },
  "statusCode": 200
}
```

### 5. Update Profile

**Endpoint:** `PUT /user/profile`

**Headers:** `Authorization: Bearer <access_token>`

**Note:** Both Influencers and Students can update their profile information.

**Request Body:**

```json
{
  "firstName": "Rahul",
  "lastName": "Sharma",
  "state": "Maharashtra",
  "district": "Mumbai",
  "city": "Mumbai",
  "pincode": "400001"
}
```

**Response for Students:**

```json
{
  "success": true,
  "data": {
    "id": "user_001",
    "firstName": "Rahul",
    "lastName": "Sharma",
    "email": "rahul.sharma@example.com",
    "mobile": "9876543210",
    "state": "Maharashtra",
    "district": "Mumbai",
    "city": "Mumbai",
    "pincode": "400001",
    "profileImage": "https://example.com/avatar.jpg",
    "roleId": 4,
    "role": "student",
    "isVerified": true,
    "createdAt": "2024-01-15T10:00:00Z",
    "updatedAt": "2024-01-25T10:00:00Z"
  },
  "statusCode": 200
}
```

**Response for Influencers:**

```json
{
  "success": true,
  "data": {
    "id": "user_002",
    "firstName": "Priya",
    "lastName": "Patel",
    "email": "priya.patel@example.com",
    "mobile": "8765432109",
    "state": "Gujarat",
    "district": "Ahmedabad",
    "city": "Ahmedabad",
    "pincode": "380001",
    "profileImage": "https://example.com/avatar.jpg",
    "roleId": 3,
    "role": "influencer",
    "isVerified": true,
    "createdAt": "2024-01-10T14:30:00Z",
    "updatedAt": "2024-01-25T10:00:00Z"
  },
  "statusCode": 200
}
```

### 6. Logout

**Endpoint:** `POST /auth/logout`

**Headers:** `Authorization: Bearer <access_token>`

**Response:**

```json
{
  "success": true,
  "data": {
    "message": "Logged out successfully"
  },
  "statusCode": 200
}
```

### 7. Upload Videos

**Endpoint:** `POST /video/upload`

**Headers:**

- `Authorization: Bearer <access_token>`
- `Content-Type: multipart/form-data`

**Request Body:** Form data with:

- `videoFile`: Video file
- `eventId`: Event ID
- `title`: Video title (optional)
- `description`: Video description (optional)

**Response:**

```json
{
  "success": true,
  "data": {
    "id": "vs_001",
    "userId": "user_001",
    "eventId": "event_001",
    "videoUrl": "https://example.com/videos/national_anthem.mp4",
    "thumbnailUrl": "https://example.com/thumbnails/national_anthem.jpg",
    "duration": 120,
    "title": "My National Anthem Performance",
    "description": "Singing the national anthem with pride",
    "uploadedAt": "2024-01-20T10:00:00Z",
    "status": "pending"
  },
  "statusCode": 200
}
```

### 8. Subscription Update

**Endpoint:** `POST /subscription/update`

**Headers:** `Authorization: Bearer <access_token>`

**Request Body:**

```json
{
  "plan": "premium",
  "paymentMethod": "razorpay",
  "amount": 100
}
```

**Response:**

```json
{
  "success": true,
  "data": {
    "id": "sub_001",
    "userId": "user_001",
    "plan": "premium",
    "amount": 100,
    "paymentMethod": "razorpay",
    "status": "active",
    "startDate": "2024-01-25T10:00:00Z",
    "endDate": "2025-01-25T10:00:00Z",
    "transactionId": "txn_987654321"
  },
  "statusCode": 200
}
```

---

## üë• Role System

### Role IDs

- **1** = Super Admin (Full system access)
- **2** = Admin (System management access)
- **3** = Influencer (Content creation and management)
- **4** = Student (Can register through mobile app)

### Mobile App Scope

- **Mobile app is only for Influencers (roleId: 3) and Students (roleId: 4)**
- **Super Admins (roleId: 1) and Admins (roleId: 2) use web-based admin panel only**
- Mobile app registration is restricted to students only (roleId: 4)
- Influencers (roleId: 3) are created and managed through admin panel
- Role validation ensures proper access control and feature availability

---

## üìÖ Event Validation Logic

### Mobile App Role-Based Event Access

- **Students (roleId: 4)**: Access talent competition events with video upload capabilities
- **Influencers (roleId: 3)**: Access only school registration and history events
- **Super Admins & Admins**: Web-based admin panel access (not mobile app)

### Student Events (Talent Competitions)

- **Event Period**: `startDate` to `endDate` - Overall event duration
- **Upload Period**: `uploadStartDate` to `uploadEndDate` - When students can upload videos
- **isActive**: Event must be active for any operations
- **canUpload**: Boolean indicating if uploads are currently allowed
- **allowedRoles**: Array of role IDs that can access this event

### Influencer Events

- **School Registration**: Register schools to participate in competitions
- **History**: View school participation history and achievements
- **No video uploads**: Influencers don't upload videos

### Upload Validation Rules (Students Only)

1. **Event must be active** (`isActive: true`)
2. **Current date must be within upload period** (`uploadStartDate` ‚â§ now ‚â§ `uploadEndDate`)
3. **User must have active subscription** (`subscription.status: "active"`)
4. **User must have upload quota available** (`videosUploadedThisMonth < maxVideosPerMonth`)
5. **User role must be allowed** (`allowedRoles` includes user's roleId)

### Subscription Validation (Students Only)

- **canUploadVideos**: Based on subscription status and plan
- **maxVideosPerMonth**: Plan-based upload limit
- **videosUploadedThisMonth**: Current month's upload count

---

## üìù Data Types

### User

```typescript
interface User {
  id: string;
  firstName: string;
  lastName: string;
  email: string;
  mobile: string;
  state: string;
  district: string;
  city: string;
  pincode: string;
  profileImage?: string;
  roleId: number; // 3 = influencer, 4 = student (mobile app only)
  role: 'influencer' | 'student';
  isVerified: boolean;
  createdAt: string;
  updatedAt: string;
}
```

### Event

```typescript
interface Event {
  id: string;
  title: string;
  description: string;
  category: string;
  isActive: boolean;
  startDate: string;
  endDate: string;
  canUpload: boolean;
  uploadStartDate: string;
  uploadEndDate: string;
  allowedRoles?: number[]; // Array of role IDs that can access this event
  createdAt: string;
}

interface InfluencerEvent {
  id: string;
  title: string;
  description: string;
  type: 'school_registration' | 'history';
  isActive: boolean;
  createdAt: string;
}
```

### Video Submission

```typescript
interface VideoSubmission {
  id: string;
  userId: string;
  eventId: string;
  videoUrl: string;
  thumbnailUrl?: string;
  duration: number;
  title?: string;
  description?: string;
  uploadedAt: string;
  status: 'pending' | 'approved' | 'rejected';
}
```

### Subscription

```typescript
interface Subscription {
  id: string;
  userId: string;
  plan: 'free' | 'premium';
  amount: number;
  paymentMethod: 'razorpay' | 'cash' | 'cheque';
  status: 'active' | 'expired' | 'pending' | 'cancelled';
  startDate: string;
  endDate: string;
  transactionId?: string;
  canUploadVideos: boolean;
  maxVideosPerMonth: number;
  videosUploadedThisMonth: number;
}
```

---

## üö® Error Codes

| Code | Description                              |
| ---- | ---------------------------------------- |
| 400  | Bad Request - Invalid input data         |
| 401  | Unauthorized - Invalid or missing token  |
| 403  | Forbidden - Insufficient permissions     |
| 404  | Not Found - Resource not found           |
| 409  | Conflict - Resource already exists       |
| 422  | Unprocessable Entity - Validation failed |
| 429  | Too Many Requests - Rate limit exceeded  |
| 500  | Internal Server Error - Server error     |

---

## üîí Security Considerations

### Content Moderation

- All video uploads are scanned for inappropriate content
- Student-focused filtering based on grade level
- Educational content validation
- Age-appropriate content restrictions

### Payment Security

- Razorpay integration with secure payment processing
- Transaction verification and validation
- Receipt generation and storage

### Data Privacy

- User data encryption at rest
- Secure token-based authentication
- GDPR compliance for user data handling

---

## üìû Support

For technical support or questions about the API:

- Email: api-support@jackmarvels.com
- Documentation: https://docs.jackmarvels.com
- Status Page: https://status.jackmarvels.com

---

_Last Updated: January 25, 2024_
_Version: 1.0.0_
